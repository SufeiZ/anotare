"use strict";angular.module("anotareApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/main"),a.state("index",{url:"/main",templateUrl:"views/main.html"}).state("annotation",{url:"/annotation",templateUrl:"views/annotation.html",controller:"AnnotationCtrl"})}]),angular.module("anotareApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("anotareApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("anotareApp").controller("AnnotationCtrl",["$scope","$http","AlbumService",function(a,b,c){a.imageScope,a.getImage=function(){c.getImage().then(function(b){a.imageScope=b.data.Album},function(a){console.log("Failed to get the image, result is "+a.toString())})}}]),angular.module("anotareApp").directive("displayAnnotation",function(){return{restrict:"E",replace:!0,template:"<div class='' id='annotation-body'><div class='editing-menu'><a href='' ng-click='switchEditMode()'>edit mode: {{editMode ? 'on' : 'off'}}</a></div><canvas id='main-canvas'></canvas><div id='annotation-text'> </div></div>",link:function(a,b,c,d){a.editMode=!1;var e,f,g,h={strokeColor:new paper.Color(.8,.9),strokeWidth:1.5,fillColor:new paper.Color(0,0,0,0)},i=({strokeColor:new paper.Color(1,1,0,1),strokeWidth:1.5,fillColor:new paper.Color(1,1,0,1)},{strokeColor:new paper.Color(.8,.9),strokeWidth:1.5,fillColor:new paper.Color(.8,.9)}),j={strokeColor:new paper.Color(.7,.1,.1,1),strokeWidth:2,fillColor:new paper.Color(0,0,0,.1)},k={strokeColor:new paper.Color(.9,.1,.1,1),strokeWidth:3,fillColor:new paper.Color(0,0,0,.3)},l={strokeColor:new paper.Color(0,0,1,1),strokeWidth:1},m={fillColor:new paper.Color(.2,.2,.8,1),strokeColor:new paper.Color(1,1,1,1),strokeWidth:.3},n=function(){e=document.getElementById("main-canvas"),e.setAttribute("width",.55*screen.availWidth),e.setAttribute("height",.75*screen.availHeight),paper.setup(e),a.getImage()};a.switchEditMode=function(){a.editMode=!a.editMode,"undefined"!=typeof g&&g.frame.toggleVisibility(!g.frame.visible)};var o=function(a){var b=function(){var a=this._size.height,b=this._size.width,c=Math.max(a/e.height,b/e.width);this.height=a*c,this.width=b*c},c=new paper.Raster(a.src);c.type="main-image",c.onLoad=b,c.position=paper.view.center},p=function(b){var c=function(b){var c=function(a){$("html,body").css("cursor","pointer"),a.active||(a.style=j)},d=function(a){$("html,body").css("cursor","default"),a.active||("pin"===a.type?a.style=i:a.style=h)},f=function(b,c){var d=function(a,b){var c=b.bounds.height/2,d=b.bounds.width/2;return a.x<d||a.x>e.width-d||a.y<c||a.y>e.height-c?!1:!0};a.editMode&&d(b.point,c)&&(c.position=b.point,c.frame.setFramePosition(b.point))},l=function(b){"undefined"!=typeof g&&g!==b&&("pin"===g.type?g.style=i:g.style=h,g.active=!1,a.editMode&&g.frame.toggleVisibility(!1)),g=b,b.active=!0,b.style=k,a.editMode&&b.frame.toggleVisibility(!0),document.getElementById("annotation-text").innerHTML=b.text};b.onMouseDrag=function(a){f(a,b)},b.onMouseEnter=function(){c(b)},b.onMouseLeave=function(){d(b)},b.onClick=function(){l(b)}},d=function(a){var b=new paper.Point(a.bounds.topLeft.x-3,a.bounds.topLeft.y-3),c=new paper.Point(a.bounds.topRight.x+3,a.bounds.topRight.y-3),d=new paper.Point(a.bounds.bottomLeft.x-3,a.bounds.bottomLeft.y+3),e=new paper.Point(a.bounds.bottomRight.x+3,a.bounds.bottomRight.y+3),f=new paper.Size(a.bounds.width+6,a.bounds.height+6),g=new paper.Path.Rectangle(b,f);g.type="frame",g.style=l,g.visible=!1,g.rectTopLeft=new paper.Path.Rectangle({width:5,height:5,style:m,position:b,visible:!1,onMouseEnter:function(a){$("html,body").css("cursor","nwse-resize")},onMouseLeave:function(a){$("html,body").css("cursor","default")},onMouseDrag:function(b){a.bounds.setTopLeft(b.point.x+3,b.point.y+3),a.frame.bounds.setTopLeft(b.point),a.frame.rectTopLeft.setPosition(b.point),a.frame.rectTopRight.position.setY(b.point.y),a.frame.rectBottomLeft.position.setX(b.point.x)}}),g.rectTopRight=new paper.Path.Rectangle({width:5,height:5,style:m,position:c,visible:!1,onMouseEnter:function(a){$("html,body").css("cursor","nesw-resize")},onMouseLeave:function(a){$("html,body").css("cursor","default")},onMouseDrag:function(b){a.bounds.setTopRight(b.point.x-3,b.point.y+3),a.frame.bounds.setTopRight(b.point),a.frame.rectTopRight.setPosition(b.point),a.frame.rectTopLeft.position.setY(b.point.y),a.frame.rectBottomRight.position.setX(b.point.x)}}),g.rectBottomLeft=new paper.Path.Rectangle({width:5,height:5,style:m,position:d,visible:!1,onMouseEnter:function(a){$("html,body").css("cursor","nesw-resize")},onMouseLeave:function(a){$("html,body").css("cursor","default")},onMouseDrag:function(b){a.bounds.setBottomLeft(b.point.x+3,b.point.y-3),a.frame.bounds.setBottomLeft(b.point),a.frame.rectBottomLeft.setPosition(b.point),a.frame.rectBottomRight.position.setY(b.point.y),a.frame.rectTopLeft.position.setX(b.point.x)}}),g.rectBottomRight=new paper.Path.Rectangle({width:5,height:5,style:m,position:e,visible:!1,onMouseEnter:function(a){$("html,body").css("cursor","nwse-resize")},onMouseLeave:function(a){$("html,body").css("cursor","default")},onMouseDrag:function(b){a.bounds.setBottomRight(b.point.x-3,b.point.y-3),a.frame.bounds.setBottomRight(b.point),a.frame.rectBottomRight.setPosition(b.point),a.frame.rectBottomLeft.position.setY(b.point.y),a.frame.rectTopRight.position.setX(b.point.x)}}),g.toggleVisibility=function(a){g.visible=a,g.rectTopLeft.visible=a,g.rectTopRight.visible=a,g.rectBottomRight.visible=a,g.rectBottomLeft.visible=a},g.setFramePosition=function(a){g.position=a},a.frame=g},f=function(a){var b=new paper.Path.Circle({radius:a.radius,style:h});return b},n=function(a){var b=new paper.Path.Rectangle({width:a.width,height:a.height,style:h});return b},o=function(a){var b=new paper.Path.Ellipse({width:a.width,height:a.height,style:h});return b},p=function(a){var b=new paper.Path.Circle({radius:3,style:i});return b};b.forEach(function(a){var b;"circle"===a.type?b=f(a):"rectangle"===a.type?b=n(a):"ellipse"===a.type?b=o(a):"pin"===a.type&&(b=p(a)),"undefined"!=typeof b?(b.type=a.type,b.position.setX(a.x),b.position.setY(a.y),b.text=a.text,b.active=!1,d(b),c(b)):console.log("Shape"+a.type+"is unidentified")})},q=function(a){"undefined"!=typeof a&&(o(a),p(a.annotations))};a.$watch("imageScope",function(a,b){"undefined"==typeof a||a.length<=0?f=b:(f=a,q(f))}),n()}}}),angular.module("anotareApp").factory("AlbumService",["$http",function(a){var b={getImage:function(){return a.get("data/album.json").success(function(a){return a.Album}).error(function(a,b){console.log("Oh no! An error! Error status: "+b)})}};return b}]);