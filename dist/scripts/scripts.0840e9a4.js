"use strict";angular.module("anotareApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/main"),a.state("index",{url:"/main",templateUrl:"views/main.html"}).state("annotation",{url:"/annotation",templateUrl:"views/annotation.html",controller:"AnnotationCtrl"})}]),angular.module("anotareApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("anotareApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("anotareApp").controller("AnnotationCtrl",["$scope","$http","AlbumService",function(a,b,c){a.imageScope,a.getImage=function(){c.getImage().then(function(b){a.imageScope=b.data.Album},function(a){console.log("Failed to get the image, result is "+a)})}}]),angular.module("anotareApp").directive("displayAnnotation",function(){return{restrict:"E",replace:!0,template:"<div><canvas id='main-canvas' width='960' height='800'></canvas><div id='annotation-text'> </div><a href='' ng-click='switchEditMode()'>edit mode: {{editMode ? 'on' : 'off'}}</a></div>",link:function(a){a.editMode=!1;var b,c,d,e={strokeColor:new paper.Color(.8,.9),strokeWidth:1.5,fillColor:new paper.Color(0,0,0,0)},f={strokeColor:new paper.Color(1,1,0,1),strokeWidth:1.5,fillColor:new paper.Color(1,1,0,1)},g={strokeColor:new paper.Color(.7,.1,.1,1),strokeWidth:2,fillColor:new paper.Color(0,0,0,.1)},h={strokeColor:new paper.Color(.9,.1,.1,1),strokeWidth:3,fillColor:new paper.Color(0,0,0,.3)},i={strokeColor:new paper.Color(0,0,1,1),strokeWidth:.5},j=function(){b=document.getElementById("main-canvas"),paper.setup(b);new paper.Path;a.getImage()};a.switchEditMode=function(){a.editMode=!a.editMode,"undefined"!=typeof d&&(d.frame.visible=!d.frame.visible)};var k=function(a){var b=new paper.Raster(a.src);b.type="main-image",b.position=paper.view.center},l=function(b){var c=function(b){var c=function(a){$("html,body").css("cursor","pointer"),a.active||(a.style=g)},i=function(a){$("html,body").css("cursor","default"),a.active||(a.style="pin"===a.type?f:e)},j=function(b,c){a.editMode&&(c.position=b.point,c.frame.position=b.point)},k=function(b){"undefined"!=typeof d&&d!==b&&(d.style="pin"===d.type?f:e,d.active=!1,a.editMode&&(d.frame.visible=!1)),d=b,b.active=!0,b.style=h,a.editMode&&(b.frame.visible=!0),document.getElementById("annotation-text").innerHTML=b.text};b.onMouseDrag=function(a){j(a,b)},b.onMouseEnter=function(){c(b)},b.onMouseLeave=function(){i(b)},b.onClick=function(){k(b)}},j=function(a){var b=new paper.Path;b.type="frame",b.style=i,b.closed=!0,b.visible=!1;var c=new paper.Point(a.bounds.topLeft.x-3,a.bounds.topLeft.y-3),d=new paper.Point(a.bounds.topRight.x+3,a.bounds.topRight.y-3),e=new paper.Point(a.bounds.bottomRight.x+3,a.bounds.bottomRight.y+3),f=new paper.Point(a.bounds.bottomLeft.x-3,a.bounds.bottomLeft.y+3);b.add(c,d,e,f),a.frame=b},k=function(a){var b=new paper.Path.Circle({radius:a.radius,style:e});return b},l=function(a){var b=new paper.Path.Rectangle({width:a.width,height:a.height,style:e});return b},m=function(a){var b=new paper.Path.Ellipse({width:a.width,height:a.height,style:e});return b},n=function(){var a=new paper.Path.Circle({radius:4,style:f});return a};b.forEach(function(a){var b;"circle"===a.type?b=k(a):"rectangle"===a.type?b=l(a):"ellipse"===a.type?b=m(a):"pin"===a.type&&(b=n(a)),"undefined"!=typeof b?(b.type=a.type,b.position.setX(a.x),b.position.setY(a.y),b.text=a.text,b.active=!1,j(b),c(b)):console.log("Shape"+a.type+"is unidentified")})},m=function(a){"undefined"!=typeof a&&(k(a),l(a.annotations))};a.$watch("imageScope",function(a,b){"undefined"==typeof a||a.length<=0?c=b:(c=a,m(c))}),j()}}}),angular.module("anotareApp").factory("AlbumService",["$http",function(a){var b={getImage:function(){return a.get("data/album.json").success(function(a){return a.Album}).error(function(a,b){console.log("Oh no! An error! Error status: "+b)})}};return b}]);